#!/bin/bash
# Atualiza pacotes
apt update
apt upgrade -y

# Remove o Haruna completamente
apt remove --purge haruna -y

# Instala VLC
apt install -y vlc

# Instala QBITTORENT
apt install -y qbittorrent

# Instala GIT
apt install -y git

# Instala SPOTIFY
apt install -y curl apt-transport-https gnupg
curl -sS https://download.spotify.com/debian/pubkey_5384CE82BA52C83A.asc | gpg --dearmor --yes -o /etc/apt/trusted.gpg.d/spotify.gpg
echo "deb https://repository.spotify.com stable non-free" | tee /etc/apt/sources.list.d/spotify.list
apt update 
apt install -y spotify-client

# Instalar BEEKEPER
# Install our GPG key
curl -fsSL https://deb.beekeeperstudio.io/beekeeper.key | gpg --dearmor --output /usr/share/keyrings/beekeeper.gpg \
  && chmod go+r /usr/share/keyrings/beekeeper.gpg

# Add the repository
echo "deb [signed-by=/usr/share/keyrings/beekeeper.gpg] https://deb.beekeeperstudio.io stable main" \
  | tee /etc/apt/sources.list.d/beekeeper-studio-app.list > /dev/null

# Update apt and install Beekeeper Studio
apt update && apt install -y beekeeper-studio

# Instalar POSTMAN
wget https://dl.pstmn.io/download/latest/linux64 -O /tmp/postman.tar.gz
tar -xzf /tmp/postman.tar.gz -C /opt
rm /tmp/postman.tar.gz
ln -s /opt/Postman/Postman /usr/local/bin/postman 
cat <<EOF > /usr/share/applications/postman.desktop
[Desktop Entry]
Name=Postman
Comment=API Development Environment
Exec=/opt/Postman/Postman
Icon=/opt/Postman/app/resources/app/assets/icon.png
Terminal=false
Type=Application 
Categories=Development;
EOF
chmod +x /opt/Postman/Postman
chmod +x /usr/share/applications/postman.desktop

# Instalar JAVA 
apt update 
apt install -y openjdk-17-jdk gdebi-core
apt update 

# Instalar MINE
apt install gdebi-core
apt update
wget https://launcher.mojang.com/download/Minecraft.deb -O /tmp/minecraft.deb
gdebi -n /tmp/minecraft.deb
rm /tmp/minecraft.deb

# Instalar LUNARCLIENT
apt update 
wget "https://api.lunarclientprod.com/site/download?os=linux" -O /opt/LunarClient.AppImage
chmod +x /opt/LunarClient.AppImage
ln -s /opt/LunarClient.AppImage /usr/bin/lunarclient

/opt/LunarClient.AppImage --appimage-extract
mv squashfs-root /opt/lunarclient
ln -s /opt/lunarclient/AppRun /usr/bin/lunarclient
chown root /opt/lunarclient/chrome-sandbox
chmod 4755 /opt/lunarclient/chrome-sandbox
find /opt/lunarclient -type d -exec chmod 755 {} \;

cat <<'EOF' > /usr/share/applications/lunarclient.desktop
[Desktop Entry]
Encoding=UTF-8
Name=Lunar Client
Comment=Lunar Client for Minecraft
Exec=/opt/lunarclient/AppRun
Icon=/opt/LunarClient.AppImage
Terminal=false
Type=Application
Categories=Game;
EOF
chmod +x /usr/share/applications/lunarclient.desktop


# Instalar Wine
apt update
apt install -y wget gnupg software-properties-common
mkdir -pm755 /etc/apt/keyrings
wget -O - https://dl.winehq.org/wine-builds/winehq.key |  gpg --dearmor -o /etc/apt/keyrings/winehq-archive.key
dpkg --add-architecture i386
wget -NP /etc/apt/sources.list.d/ https://dl.winehq.org/wine-builds/ubuntu/dists/noble/winehq-noble.sources
apt update
apt install --install-recommends winehq-stable -y


# Instalar Heroic
wget https://github.com/Heroic-Games-Launcher/HeroicGamesLauncher/releases/download/v2.18.1/Heroic-2.18.1-linux-amd64.deb -O /tmp/heroic.deb
apt update
apt install -y /tmp/heroic.deb || apt -f install -y

# Instalar VSCODE
apt update
apt install -y wget gpg apt-transport-https

wget -O /opt/code.deb "https://code.visualstudio.com/sha/download?build=stable&os=linux-deb-x64"	
apt install -y /opt/code.deb
rm -f /opt/code.deb

echo "code code/add-microsoft-repo boolean true" | debconf-set-selections

apt-get install wget gpg &&
wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg &&
install -D -o root -g root -m 644 microsoft.gpg /usr/share/keyrings/microsoft.gpg &&
rm -f microsoft.gpg

cat <<EOF > /etc/apt/sources.list.d/vscode.sources
Types: deb
URIs: https://packages.microsoft.com/repos/code
Suites: stable
Components: main
Architectures: amd64,arm64,armhf
Signed-By: /usr/share/keyrings/microsoft.gpg
EOF

apt update &&
apt install code 

# Instalar EXTRAS
apt update
apt install -y build-essential gdb python3 python3-pip python3-venv curl
# Node.js LTS + npm
curl -fsSL https://deb.nodesource.com/setup_lts.x | bash -
apt install -y nodejs
npm install -g typescript

#Instalar DOCKER ENGINE
# Pacotes básicos
apt update
apt install -y ca-certificates curl gnupg

# Criar diretório para chaves
install -m 0755 -d /etc/apt/keyrings

# Baixar chave GPG do Docker
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg
chmod a+r /etc/apt/keyrings/docker.gpg

cat <<EOF > /etc/apt/sources.list.d/docker.sources
Types: deb
URIs: https://download.docker.com/linux/ubuntu
Suites: noble
Components: stable
Signed-By: /etc/apt/keyrings/docker.gpg
EOF

# Atualizar pacotes e instalar Docker
apt update
apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# Instalar STEAM + SUPORTE GRAFICO/PREPARAR DRIVERS =====
apt install -y software-properties-common wget gnupg
add-apt-repository -y multiverse
add-apt-repository -y ppa:graphics-drivers/ppa
dpkg --add-architecture i386
apt update

# Mesa (Intel/AMD) + Vulkan + 32-bit
apt install -y mesa-vulkan-drivers mesa-utils mesa-vulkan-drivers:i386 libgl1-mesa-dri:i386

# Steam
apt install -y steam

apt autoremove -y
apt clean

# SCRIPT PARA INSTALAR OS DRIVERS
cat <<'EOF' > /usr/local/bin/install-drivers.sh
#!/bin/bash
set -e
# Atualiza lista de pacotes
apt update
# Instala automaticamente drivers detectados
ubuntu-drivers install

systemctl disable install-drivers.service
# Remove este script após a execução
rm -f /usr/local/bin/install-drivers.sh
EOF

chmod +x /usr/local/bin/install-drivers.sh

cat <<'EOF' > /etc/systemd/system/install-drivers.service
[Unit]
Description=Instalar drivers automaticamente no primeiro boot
After=network-online.target
Wants=network-online.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/install-drivers.sh
RemainAfterExit=no


[Install]
WantedBy=multi-user.target
EOF

# Habilitar o serviço
systemctl enable install-drivers.service














